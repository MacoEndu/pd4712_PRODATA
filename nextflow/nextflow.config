// Parametry domyślne pipeline
params {
    input = null
    outdir = 'results'
    threads = 4
    multiqc_title = 'MultiQC Report'
}

// Zasoby dla poszczególnych procesów
process {
    withName: MULTIQC {
        cpus = params.threads
        memory = '4 GB'
        time = '1h'
    }
    withName: FASTQC {
        cpus = params.threads
        memory = '2 GB'
        time = '30m'
    }
    
    withName: STAR_ALIGN {
        cpus = params.threads
        memory = '7 GB' 
        time = '2h'
    }
    withName: TRIMMOMATIC {
        memory = '2 GB'
        cpus = 2
        errorStrategy = 'retry'
        maxRetries = 2
    }
}

// Profile Docker z kontenerami dla każdego narzędzia
profiles {
    docker {
        docker.enabled = true
        process {
            withName: TRIMMOMATIC {
                container = 'quay.io/biocontainers/trimmomatic:0.39--hdfd78af_2'
            }
            withName: FASTQC {
                container = 'biocontainers/fastqc:v0.11.9_cv8'
            }
            withName: MULTIQC {
                container = 'ewels/multiqc:v1.14'
            }
            withName: SAMTOOLS_INDEX {
                container = 'biocontainers/samtools:v1.7.0_cv4'
            }
            withName: VARIANT_CALLING {
                container = 'staphb/bcftools:1.22'
            }
            // UWAGA: Procesy STAR_ALIGN, STAR_INDEX i MERGE_VCF wymagają instalacji narzędzi lokalnie
        }
    }
}

// Automatyczne raporty wykonania
timeline {
    enabled = true
    file = "run_reports/timeline.html"
    overwrite = true
}

report {
    enabled = true
    file = "run_reports/report.html"
    overwrite = true
}

trace {
    enabled = true
    file = "run_reports/trace.txt"
    overwrite = true
}

dag {
    enabled = true
    file = "run_reports/dag.svg"
    overwrite = true
}
